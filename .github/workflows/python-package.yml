
    # –Ω–∞–∑–≤–∞–Ω–∏–µ
name: ExLab tests ü¶Ä

# —Ü–µ–ª–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞
# –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ push –∏ pull_request, –≤ –≤–µ—Ç–∫—É main
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
jobs:
  Runs-tests:
    runs-on: ubuntu-latest
    
    # –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ —à–∞–≥–∞–º
    # name - –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–≥–∞
    steps:
          - uses: actions/checkout@v3
          - name: Set up Python
            uses: actions/setup-python@v4
            with:
                 python-version: '3.x'
          - name: Install dependencies üîß
            run: |
                   python -m pip install --upgrade pip
                   pip install -r requirements.txt
          - name: Test with pytest üî®
            run: |
                   pytest tests/test_landing_page.py --alluredir=tests/results --reruns=5 --headless=True
          
          - name: Get Allure history üïú
            uses: actions/checkout@v2
            if: always()
            continue-on-error: true
            with:
                 ref: gh-pages
                 path: gh-pages

          - name: Allure Report action from marketplace üéØ
            uses: simple-elf/allure-report-action@master
            if: always()
            id: allure-report
            with:
                  allure_results: tests/results
                  gh_pages: gh-pages
                  allure_report: allure-report
                  allure_history: allure-history

          - name: Deploy report to Github Pages ‚åõ
            if: always()
            uses: peaceiris/actions-gh-pages@v2
            env:
                PERSONAL_TOKEN: ${{ secrets.Key }}
                PUBLISH_BRANCH: gh-pages
                PUBLISH_DIR: allure-history